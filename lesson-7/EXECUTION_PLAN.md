# –ü–ª–∞–Ω –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è Lesson-7

## üìã –û–≥–ª—è–¥ –∑–∞–≤–¥–∞–Ω–Ω—è

–°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–ª–∞—Å—Ç–µ—Ä Kubernetes —É —Ç—ñ–π —Å–∞–º—ñ–π –º–µ—Ä–µ–∂—ñ (VPC), —è–∫—É –≤–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–ª–∏ –≤ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É –¥–æ–º–∞—à–Ω—å–æ–º—É –∑–∞–≤–¥–∞–Ω–Ω—ñ, —Ç–∞ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ç–∞–∫—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏:

1. ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–ª–∞—Å—Ç–µ—Ä–∞ Kubernetes —á–µ—Ä–µ–∑ Terraform
2. ‚úÖ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Elastic Container Registry (ECR) –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è Docker-–æ–±—Ä–∞–∑—É –≤–∞—à–æ–≥–æ Django-–∑–∞—Å—Ç–æ—Å—É–Ω–∫—É
3. ‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Docker-–æ–±—Ä–∞–∑—É Django –¥–æ ECR
4. ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è helm chart (deployment.yaml, service.yaml, hpa.yaml, configmap.yaml)
5. ‚úÖ –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ (env) –∑ —Ç–µ–º–∏ 4 –≤ ConfigMap

## ‚úÖ –í–∏–∫–æ–Ω–∞–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

### 1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–ª–∞—Å—Ç–µ—Ä–∞ Kubernetes —á–µ—Ä–µ–∑ Terraform
- **–§–∞–π–ª**: `modules/eks/eks.tf`
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏**:
  - EKS –∫–ª–∞—Å—Ç–µ—Ä –∑ –≤–µ—Ä—Å—ñ—î—é 1.28
  - IAM —Ä–æ–ª—ñ –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∞ —Ç–∞ –≥—Ä—É–ø–∏ –≤—É–∑–ª—ñ–≤
  - Security Groups –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∞ —Ç–∞ –≤—É–∑–ª—ñ–≤
  - –ì—Ä—É–ø–∞ –≤—É–∑–ª—ñ–≤ –∑ —Ç–∏–ø–æ–º t3.medium (2-4 –≤—É–∑–ª–∏)

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ECR
- **–§–∞–π–ª**: `modules/ecr/ecr.tf` (—É—Å–ø–∞–¥–∫–æ–≤–∞–Ω–æ –∑ lesson-5)
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏**:
  - ECR —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π lesson-7-ecr
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –æ–±—Ä–∞–∑—ñ–≤
  - –ü–æ–ª—ñ—Ç–∏–∫–∞ –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É
  - –ü–æ–ª—ñ—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø—É

### 3. Django –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫
- **–§–∞–π–ª–∏**: `django-app/`
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏**:
  - Django 4.2.7 –ø—Ä–æ–µ–∫—Ç
  - Gunicorn WSGI —Å–µ—Ä–≤–µ—Ä
  - Health check endpoint (/health/)
  - Dockerfile –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü—ñ—ó
  - –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ —á–µ—Ä–µ–∑ python-decouple

### 4. Helm Charts
- **–§–∞–π–ª–∏**: `charts/django-app/`
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏**:
  - `deployment.yaml` - —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –∑ health checks —Ç–∞ —Ä–µ—Å—É—Ä—Å–Ω–∏–º–∏ –ª—ñ–º—ñ—Ç–∞–º–∏
  - `service.yaml` - LoadBalancer –¥–ª—è –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ –¥–æ—Å—Ç—É–ø—É
  - `hpa.yaml` - Horizontal Pod Autoscaler (2-6 –ø–æ–¥—ñ–≤, >70% CPU/Memory)
  - `configmap.yaml` - –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
  - `values.yaml` - –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏

### 5. –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –≤ ConfigMap
- **–§–∞–π–ª**: `charts/django-app/templates/configmap.yaml`
- **–ó–º—ñ–Ω–Ω—ñ**:
  - DEBUG, SECRET_KEY, ALLOWED_HOSTS
  - STATIC_URL, STATIC_ROOT, LOG_LEVEL
  - ENVIRONMENT

## üöÄ –ö—Ä–æ–∫–∏ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

### –ï—Ç–∞–ø 1: –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏
```bash
cd lesson-7

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Terraform
terraform init

# –ü–µ—Ä–µ–≥–ª—è–¥ –ø–ª–∞–Ω—É
terraform plan

# –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω (—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è EKS –∫–ª–∞—Å—Ç–µ—Ä–∞)
terraform apply
```

### –ï—Ç–∞–ø 2: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è kubectl
```bash
# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è kubectl –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ EKS –∫–ª–∞—Å—Ç–µ—Ä–æ–º
./scripts/setup-kubectl.sh
```

### –ï—Ç–∞–ø 3: –ó–±—ñ—Ä–∫–∞ —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Docker –æ–±—Ä–∞–∑—É
```bash
# –ó–±—ñ—Ä–∫–∞ Django –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤ ECR
./scripts/build-and-push.sh
```

### –ï—Ç–∞–ø 4: –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É
```bash
# –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —á–µ—Ä–µ–∑ Helm
./scripts/deploy.sh
```

## üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ EKS –∫–ª–∞—Å—Ç–µ—Ä–∞
aws eks describe-cluster --name lesson-7-eks-cluster --region us-west-2

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ ECR —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
aws ecr describe-repositories --repository-names lesson-7-ecr --region us-west-2
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Kubernetes —Ä–µ—Å—É—Ä—Å—ñ–≤
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ–¥—ñ–≤
kubectl get pods -l app.kubernetes.io/name=django-app

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–µ—Ä–≤—ñ—Å—ñ–≤
kubectl get svc django-app

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ HPA
kubectl get hpa django-app

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ ConfigMap
kubectl get configmap django-app-config
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É
```bash
# –û—Ç—Ä–∏–º–∞–Ω–Ω—è URL LoadBalancer
kubectl get svc django-app -o jsonpath='{.status.loadBalancer.ingress[0].hostname}'

# –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è health check
curl http://[load-balancer-url]/health/
```

## üìä –û—á—ñ–∫—É–≤–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏

### –ü—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è terraform apply:
- ‚úÖ EKS –∫–ª–∞—Å—Ç–µ—Ä lesson-7-eks-cluster —Å—Ç–≤–æ—Ä–µ–Ω–æ
- ‚úÖ ECR —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π lesson-7-ecr —Å—Ç–≤–æ—Ä–µ–Ω–æ
- ‚úÖ VPC –∑ –ø—É–±–ª—ñ—á–Ω–∏–º–∏ —Ç–∞ –ø—Ä–∏–≤–∞—Ç–Ω–∏–º–∏ –ø—ñ–¥–º–µ—Ä–µ–∂–∞–º–∏ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ

### –ü—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è build-and-push.sh:
- ‚úÖ Docker –æ–±—Ä–∞–∑ Django –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –≤ ECR
- ‚úÖ –û–±—Ä–∞–∑ –¥–æ—Å—Ç—É–ø–Ω–∏–π –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ Kubernetes

### –ü—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è deploy.sh:
- ‚úÖ Django –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–æ –≤ Kubernetes
- ‚úÖ LoadBalancer —Å—Ç–≤–æ—Ä–µ–Ω–æ —Ç–∞ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ
- ‚úÖ HPA –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
- ‚úÖ ConfigMap –∑ –∑–º—ñ–Ω–Ω–∏–º–∏ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ —Å—Ç–≤–æ—Ä–µ–Ω–æ

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –õ–æ–∫–∞–ª—å–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è Django –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É
```bash
cd django-app
./test-local.sh
```

### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤ Kubernetes
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª–æ–≥—ñ–≤
kubectl logs -l app.kubernetes.io/name=django-app

# –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
kubectl scale deployment django-app --replicas=4
kubectl get hpa django-app
```

## üßπ –û—á–∏—â–µ–Ω–Ω—è

### –í–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É
```bash
helm uninstall django-app
```

### –í–∏–¥–∞–ª–µ–Ω–Ω—è —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏
```bash
terraform destroy
```

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤—ñ –∑–∞—É–≤–∞–∂–µ–Ω–Ω—è

1. **AWS Account ID**: –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –≤ `charts/django-app/values.yaml`
2. **–í–∞—Ä—Ç—ñ—Å—Ç—å**: EKS –∫–ª–∞—Å—Ç–µ—Ä —Ç–∞ LoadBalancer —î –ø–ª–∞—Ç–Ω–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏
3. **–ë–µ–∑–ø–µ–∫–∞**: –ó–º—ñ–Ω—ñ—Ç—å SECRET_KEY –¥–ª—è production
4. **–†–µ–≥—ñ–æ–Ω**: –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è us-west-2

## üìö –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ä–µ—Å—É—Ä—Å–∏

- [Terraform AWS Provider](https://registry.terraform.io/providers/hashicorp/aws/latest/docs)
- [Amazon EKS](https://docs.aws.amazon.com/eks/)
- [Helm Documentation](https://helm.sh/docs/)
- [Kubernetes Documentation](https://kubernetes.io/docs/) 