# Lesson-5: Terraform Infrastructure на AWS

Цей проєкт демонструє створення інфраструктури на AWS за допомогою Terraform з використанням модульної архітектури.

## Структура проєкту

```
lesson-5/
│
├── main.tf                  # Головний файл для підключення модулів
├── backend.tf               # Налаштування бекенду для стейтів (S3 + DynamoDB)
├── outputs.tf               # Загальне виведення ресурсів
│
├── modules/                 # Каталог з усіма модулями
│   │
│   ├── s3-backend/          # Модуль для S3 та DynamoDB
│   │   ├── s3.tf            # Створення S3-бакета
│   │   ├── dynamodb.tf      # Створення DynamoDB
│   │   ├── variables.tf     # Змінні для S3
│   │   └── outputs.tf       # Виведення інформації про S3 та DynamoDB
│   │
│   ├── vpc/                 # Модуль для VPC
│   │   ├── vpc.tf           # Створення VPC, підмереж, Internet Gateway
│   │   ├── routes.tf        # Налаштування маршрутизації
│   │   ├── variables.tf     # Змінні для VPC
│   │   └── outputs.tf       # Виведення інформації про VPC
│   │
│   └── ecr/                 # Модуль для ECR
│       ├── ecr.tf           # Створення ECR репозиторію
│       ├── variables.tf     # Змінні для ECR
│       └── outputs.tf       # Виведення URL репозиторію ECR
│
└── README.md                # Документація проєкту
```

## Опис модулів

### 1. Модуль s3-backend

Цей модуль створює інфраструктуру для зберігання та блокування стейт-файлів Terraform:

- **S3 бакет**: Для зберігання стейт-файлів з увімкненим версіюванням
- **DynamoDB таблиця**: Для блокування стейтів під час виконання операцій
- **Безпека**: Шифрування, блокування публічного доступу, політика життєвого циклу

### 2. Модуль vpc

Модуль для створення мережевої інфраструктури:

- **VPC**: Віртуальна приватна хмара з CIDR блоком 10.0.0.0/16
- **Публічні підмережі**: 3 підмережі з автоматичним призначенням публічних IP
- **Приватні підмережі**: 3 підмережі без прямого доступу до інтернету
- **Internet Gateway**: Для доступу публічних підмереж до інтернету
- **NAT Gateway**: Для доступу приватних підмереж до інтернету
- **Route Tables**: Налаштування маршрутизації для обох типів підмереж

### 3. Модуль ecr

Модуль для створення репозиторію Docker образів:

- **ECR репозиторій**: Для зберігання Docker образів
- **Автоматичне сканування**: Сканування образів на вразливості при пуші
- **Політика життєвого циклу**: Автоматичне очищення старих образів
- **Політика доступу**: Контроль доступу до репозиторію

## Передумови

1. **Terraform**: Версія >= 1.0
2. **AWS CLI**: Налаштований з відповідними credentials
3. **AWS Account**: З необхідними правами для створення ресурсів

## Команди для використання

### Ініціалізація проєкту
```bash
cd lesson-5
terraform init
```

### Перегляд плану змін
```bash
terraform plan
```

### Застосування змін
```bash
terraform apply
```

### Видалення інфраструктури
```bash
terraform destroy
```

### Перегляд вихідних даних
```bash
terraform output
```

## Важливі зауваження

1. **S3 бакет**: Ім'я бакета повинно бути унікальним глобально в AWS
2. **NAT Gateway**: Платний ресурс, використовуйте тільки при необхідності
3. **ECR політика**: Модуль намагається отримати дані про AWS організацію, якщо вона не існує, можуть виникнути помилки

## Безпека

- Всі ресурси створюються з відповідними тегами для ідентифікації
- S3 бакет має блокування публічного доступу
- ECR репозиторій має політику доступу
- VPC налаштована з правильним розділенням публічних та приватних підмереж

## Вихідні дані

Після успішного виконання `terraform apply` ви отримаєте:

- URL S3 бакета для стейт-файлів
- Ім'я DynamoDB таблиці для блокування
- ID VPC та підмереж
- URL ECR репозиторію

## Підтримка

Для питань або проблем звертайтеся до документації Terraform та AWS. 